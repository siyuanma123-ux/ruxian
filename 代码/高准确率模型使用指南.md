# é«˜å‡†ç¡®ç‡æ¨¡å‹ä½¿ç”¨æŒ‡å—ï¼ˆå‡†ç¡®ç‡â‰¥80%ï¼‰

## âœ… å·²ä¸‹è½½çš„æ¨¡å‹

### End-to-end All Convolutional Design
- **ä½ç½®**: `../pretrained_models/end-to-end_all_convolutional_design/`
- **å‡†ç¡®ç‡**: 
  - DDSM: AUC 0.86-0.91 (å•æ¨¡å‹0.86-0.88, 3æ¨¡å‹å¹³å‡0.91)
  - INbreast: AUC 0.92-0.96 (å•æ¨¡å‹0.92-0.95, 2æ¨¡å‹å¹³å‡0.96)
- **è®ºæ–‡**: https://arxiv.org/abs/1708.09427
- **GitHub**: https://github.com/lishen/end2end-all-conv

## ğŸ“¥ ä¸‹è½½é¢„è®­ç»ƒæƒé‡

### æ–¹æ³•1: ä»Google Driveä¸‹è½½ï¼ˆæ¨èï¼‰

1. **è®¿é—®Google Driveé“¾æ¥**:
   - å…¨å›¾åƒæ¨¡å‹: https://drive.google.com/drive/folders/0B1PVLadG_dCKV2pZem5MTjc1cHc
   - Patchåˆ†ç±»å™¨: https://drive.google.com/drive/folders/0B1PVLadG_dCKZDVNYWZ1bll0cFU

2. **æ¨èä¸‹è½½çš„æ¨¡å‹**:
   - **INbreast VGG16 [512-512-1024]x2**: AUC 0.95 (å•æ¨¡å‹), 0.96 (2æ¨¡å‹å¹³å‡) â­ æœ€é«˜å‡†ç¡®ç‡
   - **DDSM Resnet50 [512-512-1024]x2**: AUC 0.86 (å•æ¨¡å‹), 0.91 (3æ¨¡å‹å¹³å‡)

3. **ä¸‹è½½åä¿å­˜ä½ç½®**:
   ```bash
   mkdir -p ../pretrained_models/end-to-end_all_convolutional_design/weights
   # å°†ä¸‹è½½çš„.h5æ–‡ä»¶æ”¾åˆ°weightsç›®å½•
   ```

### æ–¹æ³•2: ä½¿ç”¨gdownï¼ˆå¦‚æœGoogle Driveé“¾æ¥æ”¯æŒï¼‰

```bash
pip install gdown

# ä¸‹è½½INbreastæœ€ä½³æ¨¡å‹ï¼ˆéœ€è¦è·å–æ–‡ä»¶IDï¼‰
# gdown <file_id> -O ../pretrained_models/end-to-end_all_convolutional_design/weights/
```

## ğŸ”§ ç¯å¢ƒé…ç½®

### 1. å®‰è£…ä¾èµ–

```bash
# æ³¨æ„ï¼šè¿™ä¸ªæ¨¡å‹éœ€è¦Keras < 2.1.0
pip install keras==2.0.8 tensorflow-gpu==1.x  # æˆ– tensorflow==1.x
pip install h5py numpy scipy pillow
```

### 2. è®¾ç½®PYTHONPATH

```bash
export PYTHONPATH=$PYTHONPATH:/Users/masiyuan/Desktop/ä¹³è…ºç™Œ/pretrained_models/end-to-end_all_convolutional_design
```

æˆ–è€…åœ¨Pythonä»£ç ä¸­ï¼š
```python
import sys
sys.path.append('/Users/masiyuan/Desktop/ä¹³è…ºç™Œ/pretrained_models/end-to-end_all_convolutional_design')
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨æ¨ç†è„šæœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

æ£€æŸ¥æ˜¯å¦æœ‰ `dm_inference.py` æˆ–ç±»ä¼¼çš„æ¨ç†è„šæœ¬ï¼š
```bash
cd ../pretrained_models/end-to-end_all_convolutional_design
python dm_inference.py --model weights/your_model.h5 --image your_image.png
```

### æ–¹æ³•2: åœ¨Pythonä»£ç ä¸­ä½¿ç”¨

```python
import sys
sys.path.append('../pretrained_models/end-to-end_all_convolutional_design')

from dm_image import load_image
from dm_resnet import build_model
import keras

# åŠ è½½æ¨¡å‹
model_path = '../pretrained_models/end-to-end_all_convolutional_design/weights/inbreast_vgg16_[512-512-1024]x2.h5'
model = keras.models.load_model(model_path)

# åŠ è½½å’Œé¢„å¤„ç†å›¾åƒ
image_path = 'your_mammography_image.png'
img = load_image(image_path, img_size=(1152, 896), rescale_factor=0.003891)

# é¢„æµ‹
prediction = model.predict(img)
print(f"é¢„æµ‹ç»“æœ: {prediction}")
```

### æ–¹æ³•3: é›†æˆåˆ°å¯¹æ¯”è„šæœ¬

ä¿®æ”¹ `compare_with_baseline_models.py`:

```python
import sys
sys.path.append('../pretrained_models/end-to-end_all_convolutional_design')
from dm_resnet import build_model
import keras

class EndToEndAllConvModel(nn.Module):
    """End-to-end All Convolutional Designæ¨¡å‹"""
    
    def __init__(self, num_classes=2, model_path=None):
        super().__init__()
        # åŠ è½½Kerasæ¨¡å‹
        if model_path:
            self.keras_model = keras.models.load_model(model_path)
        else:
            # ä½¿ç”¨é»˜è®¤æ¨¡å‹
            self.keras_model = build_model(...)
    
    def forward(self, x):
        # è½¬æ¢PyTorch tensoråˆ°numpyï¼Œç„¶ååˆ°Kerasæ ¼å¼
        x_np = x.cpu().numpy()
        # è°ƒæ•´ç»´åº¦é¡ºåº: (B, C, H, W) -> (B, H, W, C)
        x_np = np.transpose(x_np, (0, 2, 3, 1))
        
        # Kerasé¢„æµ‹
        with torch.no_grad():
            pred = self.keras_model.predict(x_np)
        
        # è½¬æ¢å›PyTorch tensor
        return torch.from_numpy(pred)
```

## ğŸ“Š æ¨¡å‹æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹ | æ•°æ®é›† | å•æ¨¡å‹AUC | å¤šæ¨¡å‹å¹³å‡AUC |
|------|--------|-----------|--------------|
| VGG16 [512-512-1024]x2 | INbreast | 0.95 | 0.96 |
| VGG16 512x1 | INbreast | 0.92 | 0.94 |
| Resnet50 [512-512-1024]x2 | DDSM | 0.86 | 0.91 |
| VGG16 [512-512-1024]x2 | DDSM | 0.85 | 0.88 |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å›¾åƒå°ºå¯¸**: æ¨¡å‹å›ºå®šè¾“å…¥å°ºå¯¸ä¸º 1152x896
2. **é¢„å¤„ç†**: 
   - éœ€è¦rescale factorï¼ˆPNGæ ¼å¼é€šå¸¸æ˜¯0.003891ï¼‰
   - éœ€è¦è®¡ç®—åƒç´ å‡å€¼è¿›è¡Œå½’ä¸€åŒ–
3. **Kerasç‰ˆæœ¬**: å¿…é¡»ä½¿ç”¨ Keras < 2.1.0ï¼ˆæ¨è2.0.8ï¼‰
4. **TensorFlowç‰ˆæœ¬**: éœ€è¦TensorFlow 1.xï¼ˆä¸Keras 2.0.8å…¼å®¹ï¼‰
5. **ç±»åˆ«**: æ¨¡å‹è¾“å‡ºæ˜¯äºŒåˆ†ç±»ï¼ˆæ­£å¸¸/å¼‚å¸¸ï¼‰ï¼Œä¸æ˜¯å››åˆ†ç±»

## ğŸ”„ ç±»åˆ«æ˜ å°„

å¦‚æœæ¨¡å‹æ˜¯äºŒåˆ†ç±»ï¼Œéœ€è¦æ˜ å°„åˆ°å››åˆ†ç±»ï¼š
```python
# æ¨¡å‹è¾“å‡º: [æ­£å¸¸æ¦‚ç‡, å¼‚å¸¸æ¦‚ç‡]
# æ˜ å°„åˆ°å››åˆ†ç±»:
# - æ­£å¸¸æ¦‚ç‡é«˜ -> æ­£å¸¸ (Normal)
# - å¼‚å¸¸æ¦‚ç‡é«˜ -> éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­ï¼ˆè‰¯æ€§/åŸä½ç™Œ/æµ¸æ¶¦ç™Œï¼‰
```

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… æ¨¡å‹ä»£ç å·²ä¸‹è½½
2. â³ ä¸‹è½½é¢„è®­ç»ƒæƒé‡ï¼ˆä»Google Driveï¼‰
3. â³ å®‰è£…ä¾èµ–ç¯å¢ƒï¼ˆKeras 2.0.8, TensorFlow 1.xï¼‰
4. â³ æµ‹è¯•æ¨¡å‹æ¨ç†
5. â³ é›†æˆåˆ°å¯¹æ¯”è„šæœ¬

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä¸‹è½½Google Driveæ–‡ä»¶ï¼Ÿ
A: å¯ä»¥ï¼š
1. ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®é“¾æ¥ä¸‹è½½
2. ä½¿ç”¨gdownå·¥å…·ï¼ˆå¦‚æœé“¾æ¥æ”¯æŒï¼‰
3. ä½¿ç”¨Google Drive API

### Q: Keras 2.0.8å’ŒTensorFlow 1.xå¤ªæ—§äº†æ€ä¹ˆåŠï¼Ÿ
A: å¯ä»¥ï¼š
1. ä½¿ç”¨condaåˆ›å»ºç‹¬ç«‹ç¯å¢ƒ
2. æˆ–è€…å°è¯•ä¿®æ”¹ä»£ç é€‚é…æ–°ç‰ˆæœ¬ï¼ˆå¯èƒ½éœ€è¦å¤§é‡ä¿®æ”¹ï¼‰

### Q: æ¨¡å‹è¾“å‡ºæ˜¯äºŒåˆ†ç±»ï¼Œå¦‚ä½•ç”¨äºå››åˆ†ç±»å¯¹æ¯”ï¼Ÿ
A: å¯ä»¥ï¼š
1. åªå¯¹æ¯”äºŒåˆ†ç±»ç»“æœï¼ˆæ­£å¸¸ vs å¼‚å¸¸ï¼‰
2. æˆ–è€…ä½¿ç”¨å…¶ä»–å››åˆ†ç±»æ¨¡å‹è¿›è¡Œå¯¹æ¯”

## ğŸ“š å…¶ä»–é«˜å‡†ç¡®ç‡æ¨¡å‹

å¦‚æœè¿™ä¸ªæ¨¡å‹ä½¿ç”¨å›°éš¾ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **MV-Swin-T**: 
   - GitHub: https://github.com/prithuls/MV-Swin-T
   - ä½¿ç”¨PyTorchï¼Œæ›´ç°ä»£
   - ä¸‹è½½: `git clone https://github.com/prithuls/MV-Swin-T.git`

2. **æŸ¥æ‰¾å…¶ä»–PyTorchæ¨¡å‹**:
   - æœç´¢ "breast cancer pytorch pretrained"
   - æŸ¥çœ‹Papers with Codeç½‘ç«™


